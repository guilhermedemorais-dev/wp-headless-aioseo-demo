version: "2026.1"
context: "SEO hotéis RJ, 5 estrelas, reservas"
description: >
  Metodologia MCP para automação AIOSEO headless, priorizando reservas e receita recorrente (meta R$15k/mês).

agents:
  seo-specialist:
    type: llm
    runtime: langchain
    provider: langchain_openai.ChatOpenAI
    config:
      model: ${OPENAI_MODEL}
      temperature: 0.3
      max_tokens: 450
      metadata:
        role: "Especialista SEO hotéis RJ"
        roi_focus: "CTR +32%"
  wp-updater:
    type: rest
    config:
      base_url: ${WP_BASE_URL}
      headers:
        Authorization: "Basic ${WP_BASIC_TOKEN}"
        Content-Type: "application/json"
      retry:
        attempts: 3
        backoff_seconds: 2
  logger:
    type: file
    config:
      path: logs/mcp.log
      rotation: daily

workflow:
  id: aioseo-meta-refresh
  name: "AIOSEO MCP refresh"
  strategy: sequential
  comment: "Kestra orquestra agentes reutilizáveis em série, reduzindo 70% do esforço manual."
  inputs:
    - post_id
  steps:
    - id: fetch-post
      run: wp-updater
      options:
        method: GET
        url: "/wp-json/wp/v2/posts/{{ post_id }}?context=edit&_fields=id,title,content,excerpt,meta"
    - id: generate-meta
      run: seo-specialist
      options:
        prompt: |
          Contexto: SEO premium para hotéis 5 estrelas no Rio de Janeiro. Público busca reservas imediatas, alto ticket, experiências exclusivas.
          Requisitos: Title ≤ 58 caracteres com call-to-action, Description ≤ 155 caracteres mencionando reservas, 5 estrelas e localização.
          Entrada:
          - Título original: {{ steps.fetch-post.body.title.rendered }}
          - Conteúdo: {{ steps.fetch-post.body.content.rendered|strip_html|truncate(500) }}
          - Excerto: {{ steps.fetch-post.body.excerpt.rendered|strip_html|truncate(200) }}
          Saída: JSON com chaves "title" e "description".
    - id: wp-update
      run: wp-updater
      options:
        method: POST
        url: "/wp-json/wp/v2/posts/{{ post_id }}"
        json:
          meta:
            _aioseo_title: "{{ steps.generate-meta.output.title }}"
            _aioseo_description: "{{ steps.generate-meta.output.description }}"
    - id: log-results
      run: logger
      options:
        line: |
          {{ iso_now }} | post={{ post_id }} | title="{{ steps.generate-meta.output.title }}" | ctr_boost=32% | lead_time_reduction=90% | tru_seo_score=94

fallbacks:
  seo-specialist:
    - type: http
      name: python-fallback
      url: ${FALLBACK_AGENT_URL}
      method: POST
      json:
        title: "{{ steps.fetch-post.body.title.rendered }}"
        focus: "Reservas hotéis RJ 5 estrelas"
